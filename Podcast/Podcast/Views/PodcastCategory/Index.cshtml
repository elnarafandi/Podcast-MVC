@model PodcastCategoryVM

<main>
    <section id="all-podcasts">
        <div class="my-container">
            <div class="sorting-filter">
                <div class="text"><p>Category: @Model.PodcastCategory.Name</p></div>
                <div class="mix">
                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Sorting
                        </button>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item" asp-action="Index" asp-route-id="@Model.PodcastCategory.Id" asp-route-sortOrder="most_followed">Most followed</a>
                            </li>
                            <li>
                                <a class="dropdown-item" asp-action="Index" asp-route-id="@Model.PodcastCategory.Id">Default</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="podcasts">
                <!-- Burada id əlavə etdik -->
                <div class="all-podcasts parent-elem">
                    <partial name="_PodcastPartial" model="@Model" />
                </div>
                
                    
                
            </div>
        </div>
    </section>
    @if (Model.PodcastCount>8)
    {
        <section id="button">
            <div class="show-more mt-5 text-center"
                 data-count="@Model.Podcasts.Count()"
                 data-category-id="@Model.PodcastCategory.Id"
                 data-sort-order="@Context.Request.Query["sortOrder"]">
                <button type="button" class="btn btn-primary">Show more</button>
            </div>
        </section>
    }
</main>




<script>
    document.addEventListener("DOMContentLoaded", function () {
        const showMoreBtn = document.querySelector(".show-more"); // <div class="show-more" ...>
        const parentElem = document.querySelector(".parent-elem"); // .parent-elem -> podcastların konteyneri

        if (!showMoreBtn || !parentElem) return;

        showMoreBtn.addEventListener("click", function () {
            const skip = parentElem.children.length;
            const totalCount = parseInt(this.getAttribute("data-count"));
            const categoryId = this.getAttribute("data-category-id");
            const sortOrder = this.getAttribute("data-sort-order") || "";

            fetch(`/PodcastCategory/ShowMore?id=${categoryId}&skip=${skip}&sortOrder=${sortOrder}`)
                .then(response => {
                    if (!response.ok) throw new Error("Network response was not ok");
                    return response.text();
                })
                .then(html => {
                    parentElem.innerHTML += html;

                    const newSkip = parentElem.children.length;
                    if (newSkip >= totalCount) {
                        showMoreBtn.classList.add("d-none");
                    }
                })
                .catch(error => {
                    console.error("Fetch error:", error);
                });
        });
    });
</script>

